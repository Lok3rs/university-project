<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tree View -->
    <record id="view_helpdesk_ticket_tree" model="ir.ui.view">
        <field name="name">helpdesk.ticket.tree</field>
        <field name="model">helpdesk.ticket</field>
        <field name="arch" type="xml">
            <list string="Tickets" create="true" edit="true" delete="false">
                <field name="name"/>
                <field name="partner_id"/>
                <field name="assignee_id"/>
                <field name="priority" widget="priority"/>
                <field name="stage"/>
                <field name="channel"/>
                <field name="sla_deadline"/>
                <field name="closed_date"/>
                <field name="create_date"/>
            </list>
        </field>
    </record>

    <!-- Kanban View -->
    <record id="view_helpdesk_ticket_kanban" model="ir.ui.view">
        <field name="name">helpdesk.ticket.kanban</field>
        <field name="model">helpdesk.ticket</field>
        <field name="arch" type="xml">
            <kanban default_group_by="stage" class="o_kanban_small_column">
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_record_top">
                                <div class="o_kanban_primary_left">
                                    <strong><field name="name"/></strong>
                                </div>
                                <div class="o_kanban_primary_right">
                                    <span class="badge badge-secondary" t-att-class="'badge badge-info'">
                                        <field name="priority"/>
                                    </span>
                                </div>
                            </div>
                            <div class="o_kanban_record_body">
                                <div>
                                    <span class="text-muted">Stage: </span><field name="stage"/>
                                </div>
                                <div>
                                    <span class="text-muted">Customer: </span><field name="partner_id"/>
                                </div>
                                <div>
                                    <span class="text-muted">Assignee: </span><field name="assignee_id"/>
                                </div>
                                <div class="mt8 text-muted">
                                    <field name="description"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Form View -->
    <record id="view_helpdesk_ticket_form" model="ir.ui.view">
        <field name="name">helpdesk.ticket.form</field>
        <field name="model">helpdesk.ticket</field>
        <field name="arch" type="xml">
            <form string="Ticket" create="true" edit="true" delete="false">
                    <header>
                        <field name="stage" widget="statusbar" statusbar_visible="new,in_progress,waiting,done"/>
                        <button type="object" name="action_view_attachments" class="oe_stat_button" icon="fa-paperclip" string="Attachments">
                            <field name="attachment_count" widget="statinfo"/>
                        </button>
                        <button name="action_start_progress" type="object" string="Start Work" class="btn-primary" invisible="stage != 'new'"/>
                        <button name="action_put_waiting" type="object" string="Put to Waiting" invisible="stage not in ['new', 'in_progress']"/>
                        <button name="action_mark_done" type="object" string="Mark as Done" class="btn-success" invisible="stage != 'in_progress'"/>
                    </header>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="partner_id"/>
                            <field name="assignee_id"/>
                            <field name="channel"/>
                        </group>
                        <group>
                            <field name="priority" widget="priority"/>
                            <field name="sla_deadline"/>
                            <field name="closed_date" readonly="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Description">
                            <field name="description" placeholder="Describe the issue..."/>
                        </page>
                    </notebook>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- Search View -->
    <record id="view_helpdesk_ticket_search" model="ir.ui.view">
        <field name="name">helpdesk.ticket.search</field>
        <field name="model">helpdesk.ticket</field>
        <field name="arch" type="xml">
            <search string="Search Tickets">
                <field name="name"/>
                <filter string="My Tickets" name="my_tickets" domain="['|', ('assignee_id','=',uid), ('create_uid','=',uid)]"/>
                <separator/>
                <filter string="New" name="stage_new" domain="[('stage','=','new')]"/>
                <filter string="In Progress" name="stage_in_progress" domain="[('stage','=','in_progress')]"/>
                <filter string="Waiting" name="stage_waiting" domain="[('stage','=','waiting')]"/>
                <filter string="Done" name="stage_done" domain="[('stage','=','done')]"/>
                <separator/>
                <filter string="Low" name="prio_low" domain="[('priority','=','0')]"/>
                <filter string="Normal" name="prio_norm" domain="[('priority','=','1')]"/>
                <filter string="High" name="prio_high" domain="[('priority','=','2')]"/>
                <group expand="0" string="Group By">
                    <filter name="group_assignee" string="Assignee" context="{'group_by':'assignee_id'}"/>
                    <filter name="group_stage" string="Stage" context="{'group_by':'stage'}"/>
                    <filter name="group_channel" string="Channel" context="{'group_by':'channel'}"/>
                    <filter name="group_customer" string="Customer" context="{'group_by':'partner_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Pivot View -->
    <record id="view_helpdesk_ticket_pivot" model="ir.ui.view">
        <field name="name">helpdesk.ticket.pivot</field>
        <field name="model">helpdesk.ticket</field>
        <field name="arch" type="xml">
            <pivot string="Ticket Analysis">
                <field name="stage" type="row"/>
                <field name="assignee_id" type="col"/>
                <field name="id" type="measure" string="Tickets"/>
            </pivot>
        </field>
    </record>

</odoo>
